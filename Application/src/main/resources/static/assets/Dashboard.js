import{A as n,l as a,K as e,s as S,q as T,B as y,Q as I,N as B,v as F,r as i,E as L,S as X,F as D,C as E,R as g,c as H,w as de,y as De,n as G,k as q,L as Se,M as Te,D as Ie}from"./main.js";import{_ as z}from"./index.js";const Fe={class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm"},ze={class:"w-full max-w-sm rounded-2xl border border-border bg-background p-6 shadow-xl"},Be={class:"flex items-start justify-between gap-3"},Le={class:"mt-4 space-y-2"},Ne={class:"flex items-center gap-2"},Oe={key:0,class:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-[2px] text-[11px] font-semibold text-green-700"},Pe={class:"flex items-center gap-2"},He={key:0,class:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-[2px] text-[11px] font-semibold text-green-700"},Re={__name:"UploadAttachmentModal",props:{ticketUploaded:{type:Boolean,default:!1},accommodationUploaded:{type:Boolean,default:!1}},emits:["close","ticket","accommodation","other"],setup(P,{emit:N}){const w=P,v=N;return(x,l)=>(a(),n("div",Fe,[e("div",ze,[e("div",Be,[l[5]||(l[5]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Attach travel documents"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Upload tickets or invoices related to this trip. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:l[0]||(l[0]=m=>v("close")),"aria-label":"Close"},[...l[4]||(l[4]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",Le,[S(F(z),{variant:"outline",class:B(["w-full justify-start",w.ticketUploaded?"border-green-500 bg-green-50 text-green-700 hover:bg-green-100":""]),onClick:l[1]||(l[1]=m=>v("ticket"))},{default:T(()=>[e("span",Ne,[l[7]||(l[7]=e("span",null,"Upload airplane ticket",-1)),w.ticketUploaded?(a(),n("span",Oe,[...l[6]||(l[6]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-3"},[e("path",{"fill-rule":"evenodd",d:"M16.704 5.29a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0l-3.25-3.25a.75.75 0 111.06-1.06L8.9 12.44l6.72-6.72a.75.75 0 011.084.57z","clip-rule":"evenodd"})],-1),I(" Uploaded ",-1)])])):y("",!0)])]),_:1},8,["class"]),S(F(z),{variant:"outline",class:B(["w-full justify-start",w.accommodationUploaded?"border-green-500 bg-green-50 text-green-700 hover:bg-green-100":""]),onClick:l[2]||(l[2]=m=>v("accommodation"))},{default:T(()=>[e("span",Pe,[l[9]||(l[9]=e("span",null,"Upload accomodation invoice",-1)),w.accommodationUploaded?(a(),n("span",He,[...l[8]||(l[8]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-3"},[e("path",{"fill-rule":"evenodd",d:"M16.704 5.29a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0l-3.25-3.25a.75.75 0 111.06-1.06L8.9 12.44l6.72-6.72a.75.75 0 011.084.57z","clip-rule":"evenodd"})],-1),I(" Uploaded ",-1)])])):y("",!0)])]),_:1},8,["class"]),S(F(z),{variant:"outline",class:"w-full justify-start",onClick:l[3]||(l[3]=m=>v("other"))},{default:T(()=>[...l[10]||(l[10]=[I(" Upload other document ",-1)])]),_:1})]),l[11]||(l[11]=e("p",{class:"mt-3 text-[11px] text-muted-foreground"}," Tickets and invoices support PDF or image files up to 10MB and will be analyzed automatically. ",-1))])]))}},Ve={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},Ee={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},Ke={class:"flex items-start justify-between gap-3"},We={class:"mt-5 space-y-4"},Ye={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},qe={class:"flex min-w-0 flex-1 items-center gap-2"},Je={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},Qe={class:"min-w-0"},Ge={class:"truncate font-medium"},Xe={class:"text-[11px] text-muted-foreground"},Ze=["onClick"],et={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},tt={key:0,class:"mt-2 text-xs text-destructive"},ot={class:"mt-5 flex items-center justify-end gap-3"},lt=["disabled"],st={__name:"TicketUploadModal",props:{chatId:{type:[Number,String],default:null}},emits:["close","uploaded"],setup(P,{emit:N}){const w=P,v=N,x=i(!1),l=i([]),m=i(null),c=i(""),p=i(!1);function U(){m.value&&m.value.click()}function $(d){if(!d||!d.length)return;const o=Array.from(d).filter(u=>!u||!u.type?!1:u.type.startsWith("image/")||u.type==="application/pdf");o.length&&(l.value=[...l.value,...o])}function h(d){const o=d?.target?.files;$(o)}function f(d){const o=d?.dataTransfer?.files;$(o),x.value=!1}function k(d){d<0||d>=l.value.length||l.value.splice(d,1)}async function A(){if(!l.value.length||p.value)return;c.value="",p.value=!0;const d=new FormData;d.append("file",l.value[0]),w.chatId&&d.append("chatId",w.chatId);try{const o=await fetch("/api/chat/upload-ticket",{method:"POST",body:d,credentials:"same-origin"}),u=await o.json().catch(()=>({}));if(!o.ok){c.value=u?.error??"Unable to process ticket.";return}v("uploaded",u)}catch{c.value="Unexpected error while uploading. Please try again."}finally{p.value=!1}}return(d,o)=>(a(),n("div",Ve,[e("div",Ee,[e("div",Ke,[o[5]||(o[5]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload airplane ticket"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your ticket here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:o[0]||(o[0]=u=>v("close")),"aria-label":"Close"},[...o[4]||(o[4]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",We,[e("div",{class:B(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[x.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:U,onDragover:o[1]||(o[1]=L(u=>x.value=!0,["prevent"])),onDragleave:o[2]||(o[2]=L(u=>x.value=!1,["prevent"])),onDrop:L(f,["prevent"])},[o[6]||(o[6]=X('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your ticket PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"ticketFileInput",ref:m,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:h},null,544)],34),l.value.length?(a(),n("div",Ye,[o[7]||(o[7]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(a(!0),n(D,null,E(l.value,(u,_)=>(a(),n("div",{key:_,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",qe,[e("div",Je,g(_+1),1),e("div",Qe,[e("p",Ge,g(u.name),1),e("p",Xe,g((u.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:M=>k(_),"aria-label":"Remove file"}," ? ",8,Ze)]))),128))])):(a(),n("div",et," No files selected yet. "))]),o[8]||(o[8]=e("p",{class:"mt-3 text-[11px] text-muted-foreground"}," The first selected file will be analyzed. Supports PDFs or images up to 10MB. ",-1)),c.value?(a(),n("p",tt,g(c.value),1)):y("",!0),e("div",ot,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:o[3]||(o[3]=u=>v("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!l.value.length||p.value,onClick:A},g(p.value?"Sending...":"Analyze ticket"),9,lt)])])]))}},rt={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},at={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},nt={class:"flex items-start justify-between gap-3"},it={class:"mt-5 space-y-4"},dt={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},ut={class:"flex min-w-0 flex-1 items-center gap-2"},ct={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},pt={class:"min-w-0"},ft={class:"truncate font-medium"},mt={class:"text-[11px] text-muted-foreground"},vt=["onClick"],gt={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},xt={key:0,class:"mt-2 text-xs text-destructive"},bt={class:"mt-5 flex items-center justify-end gap-3"},ht=["disabled"],yt={__name:"AccommodationUploadModal",props:{chatId:{type:[Number,String],default:null}},emits:["close","uploaded"],setup(P,{emit:N}){const w=P,v=N,x=i(!1),l=i([]),m=i(null),c=i(""),p=i(!1);function U(){m.value&&m.value.click()}function $(d){if(!d||!d.length)return;const o=Array.from(d).filter(u=>!u||!u.type?!1:u.type.startsWith("image/")||u.type==="application/pdf");o.length&&(l.value=[...l.value,...o])}function h(d){const o=d?.target?.files;$(o)}function f(d){const o=d?.dataTransfer?.files;$(o),x.value=!1}function k(d){d<0||d>=l.value.length||l.value.splice(d,1)}async function A(){if(!l.value.length||p.value)return;c.value="",p.value=!0;const d=new FormData;d.append("file",l.value[0]),w.chatId&&d.append("chatId",w.chatId);try{const o=await fetch("/api/chat/upload-accommodation",{method:"POST",body:d,credentials:"same-origin"}),u=await o.json().catch(()=>({}));if(!o.ok){c.value=u?.error??"Unable to process accommodation document.";return}v("uploaded",u)}catch{c.value="Unexpected error while uploading. Please try again."}finally{p.value=!1}}return(d,o)=>(a(),n("div",rt,[e("div",at,[e("div",nt,[o[5]||(o[5]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload accomodation invoice"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your invoice here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:o[0]||(o[0]=u=>v("close")),"aria-label":"Close"},[...o[4]||(o[4]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",it,[e("div",{class:B(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[x.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:U,onDragover:o[1]||(o[1]=L(u=>x.value=!0,["prevent"])),onDragleave:o[2]||(o[2]=L(u=>x.value=!1,["prevent"])),onDrop:L(f,["prevent"])},[o[6]||(o[6]=X('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your invoice PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"accommodationFileInput",ref:m,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:h},null,544)],34),l.value.length?(a(),n("div",dt,[o[7]||(o[7]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(a(!0),n(D,null,E(l.value,(u,_)=>(a(),n("div",{key:_,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",ut,[e("div",ct,g(_+1),1),e("div",pt,[e("p",ft,g(u.name),1),e("p",mt,g((u.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:M=>k(_),"aria-label":"Remove file"}," ? ",8,vt)]))),128))])):(a(),n("div",gt," No files selected yet. "))]),o[8]||(o[8]=e("p",{class:"mt-3 text-[11px] text-muted-foreground"}," The first selected file will be analyzed. Supports PDFs or images up to 10MB. ",-1)),c.value?(a(),n("p",xt,g(c.value),1)):y("",!0),e("div",bt,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:o[3]||(o[3]=u=>v("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!l.value.length||p.value,onClick:A},g(p.value?"Sending...":"Analyze invoice"),9,ht)])])]))}},kt={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},wt={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},_t={class:"flex items-start justify-between gap-3"},Ct={class:"mt-5 space-y-4"},$t={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},Mt={class:"flex min-w-0 flex-1 items-center gap-2"},Ut={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},At={class:"min-w-0"},jt={class:"truncate font-medium"},Dt={class:"text-[11px] text-muted-foreground"},St=["onClick"],Tt={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},It={class:"mt-5 flex items-center justify-end gap-3"},Ft=["disabled"],zt={__name:"OtherUploadModal",emits:["close"],setup(P,{emit:N}){const w=N,v=i(!1),x=i([]),l=i(null);function m(){l.value&&l.value.click()}function c(h){if(!h||!h.length)return;const f=Array.from(h).filter(k=>!k||!k.type?!1:k.type.startsWith("image/")||k.type==="application/pdf");f.length&&(x.value=[...x.value,...f])}function p(h){const f=h?.target?.files;c(f)}function U(h){const f=h?.dataTransfer?.files;c(f),v.value=!1}function $(h){h<0||h>=x.value.length||x.value.splice(h,1)}return(h,f)=>(a(),n("div",kt,[e("div",wt,[e("div",_t,[f[6]||(f[6]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload other document"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your document here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:f[0]||(f[0]=k=>w("close")),"aria-label":"Close"},[...f[5]||(f[5]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",Ct,[e("div",{class:B(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[v.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:m,onDragover:f[1]||(f[1]=L(k=>v.value=!0,["prevent"])),onDragleave:f[2]||(f[2]=L(k=>v.value=!1,["prevent"])),onDrop:L(U,["prevent"])},[f[7]||(f[7]=X('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your document PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"otherFileInput",ref:l,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:p},null,544)],34),x.value.length?(a(),n("div",$t,[f[8]||(f[8]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(a(!0),n(D,null,E(x.value,(k,A)=>(a(),n("div",{key:A,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",Mt,[e("div",Ut,g(A+1),1),e("div",At,[e("p",jt,g(k.name),1),e("p",Dt,g((k.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:d=>$(A),"aria-label":"Remove file"}," ? ",8,St)]))),128))])):(a(),n("div",Tt," No files selected yet. "))]),e("div",It,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:f[3]||(f[3]=k=>w("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!x.value.length,onClick:f[4]||(f[4]=k=>w("close"))}," Attach document ",8,Ft)])])]))}},Bt={class:"flex h-screen bg-background text-foreground"},Lt={class:"hidden h-full w-72 flex-col border-r border-border/60 bg-muted/30 px-4 py-6 md:flex"},Nt={class:"mt-6 flex-1 space-y-2 overflow-y-auto pr-2"},Ot=["onClick"],Pt={class:"text-sm font-medium leading-tight"},Ht={key:0,class:"text-xs text-muted-foreground/80"},Rt={class:"border-t border-border/50 pt-4"},Vt={class:"relative"},Et={key:0,class:"absolute bottom-14 left-0 w-full rounded-xl border border-border/50 bg-background/95 shadow-lg backdrop-blur"},Kt=["disabled"],Wt={class:"flex flex-1 flex-col overflow-hidden bg-background"},Yt={key:0,class:"border-b border-border/60 bg-background/80 px-6 py-5 backdrop-blur lg:px-10"},qt={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between"},Jt={class:"text-xl font-semibold tracking-tight sm:text-2xl"},Qt={key:1,class:"px-6 pt-3 text-xs text-destructive lg:px-10"},Gt={class:"relative flex flex-1 flex-col overflow-hidden"},Xt={class:"mx-auto w-full max-w-4xl space-y-6"},Zt={class:"text-xs uppercase tracking-[0.3em] text-muted-foreground/80"},eo={class:"ml-2 text-muted-foreground/60"},to={class:"mt-3 space-y-3 text-sm leading-relaxed"},oo={key:0,class:"text-sm font-semibold text-foreground"},lo={key:1,class:"space-y-3"},so=["innerHTML"],ro={key:1,class:"text-muted-foreground"},ao={key:3,class:"text-muted-foreground/70"},no={key:1,class:"rounded-3xl border border-dashed border-border/70 bg-muted/30 px-6 py-10 text-center shadow-sm"},io={class:"mt-4 flex flex-wrap items-center justify-center gap-3"},uo={class:"mt-8 text-sm"},co={class:"mt-3 flex items-center justify-center"},po={key:2,class:"rounded-2xl border border-dashed border-border/70 px-4 py-10 text-center text-sm text-muted-foreground"},fo={class:"border-t border-border/60 bg-background/95 px-6 py-5 lg:px-10"},mo={class:"mx-auto flex w-full max-w-4xl items-center gap-3 rounded-2xl border border-border/70 bg-background/80 px-4 py-3 shadow-sm"},vo=["placeholder","disabled","onKeydown"],go={key:0,class:"mt-2 text-center text-xs text-muted-foreground"},xo={key:1,class:"mt-3 flex justify-center"},bo={key:2,class:"mx-auto mt-3 w-full max-w-4xl rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-sm text-destructive"},ko={__name:"Dashboard",props:{user:{type:Object,default:()=>({})}},setup(P){const N=P,w=i(!1),v=i(""),x=i(!1),l=i(null),m=i([]),c=i([]),p=i(null),U=i(""),$=i(!1),h=i(!1),f=i(!1);i(!1),i([]),i(null);const k=i(!1);i(!1),i([]),i(null);const A=i(!1);i(!1),i([]),i(null);const d=i(""),o=i(!0),u=i(!1),_=i(!1),M=i([]),K=i(!1),W=i(!1),ue=H(()=>U.value.trim().length>0&&!$.value),J=i(null),Z=i(null),ee=i([]),Y=H(()=>Array.isArray(c.value)&&c.value.length>0),R=H(()=>!_.value),ce=H(()=>!o.value&&!_.value&&!Y.value),pe=H(()=>R.value?"Upload documents, then press Start chatting to begin...":"Describe your trip and what you need help with..."),te=H(()=>u.value||Y.value),oe=H(()=>{const r=l.value??p.value;if(!r)return"";const t=m.value.find(C=>C.id===r);if(!t||!t.title)return"";const s=String(t.title).trim();return s.length?s:""}),fe=H(()=>{const{firstName:r,lastName:t,email:s}=N.user??{};return r||t?[r,t].filter(Boolean).join(" ").trim()||"Traveler":s??"Traveler"});de(m,r=>{if(!r||r.length===0){l.value=null;return}r.find(s=>s.id===l.value)||(l.value=r[0]?.id??null)},{immediate:!0});async function me(){o.value=!0,d.value="";try{const r=await fetch("/api/dashboard",{credentials:"same-origin"});if(!r.ok){d.value="Unable to fetch dashboard data.";return}const t=await r.json().catch(()=>({})),s=Array.isArray(t.previousRecommendations)?t.previousRecommendations:[];m.value=s,c.value=Array.isArray(t.chatMessages)?t.chatMessages:[],u.value=c.value.length>0,_.value=c.value.length>0,M.value=[],K.value=!1,W.value=!1,s.length>0&&!l.value&&(l.value=s[0].id,p.value=s[0].id)}catch{d.value="Unexpected error loading dashboard."}finally{o.value=!1}}De(()=>{me(),G(()=>{J.value&&Q()})});function ve(){x.value=!x.value}function ge(){x.value=!1}function xe(){ge(),window.location.href="/settings"}function be(){l.value=null,p.value=null,c.value=[],M.value=[],U.value="",u.value=!1,_.value=!1,K.value=!1,W.value=!1}async function he(){if(!w.value){v.value="",w.value=!0;try{const r=await fetch("/logout",{method:"POST",credentials:"same-origin"}),t=await r.json().catch(()=>({}));if(!r.ok){v.value=t?.message??"Unable to log out.";return}window.location.href="/"}catch{v.value="Unexpected error. Please try again."}finally{w.value=!1}}}function Q(){const r=J.value;if(!r)return;const t=36,s=128;r.style.height="auto";const C=Math.min(Math.max(r.scrollHeight,t),s);r.style.height=`${C}px`}async function ye(r){if(!(!r||!r.id)){l.value=r.id,p.value=r.id,K.value=!1,W.value=!1,d.value="",o.value=!0;try{const t=await fetch(`/api/chat/${r.id}/messages`,{credentials:"same-origin"});if(!t.ok){d.value="Unable to load chat messages.";return}const s=await t.json().catch(()=>({}));c.value=Array.isArray(s.messages)?s.messages:[],M.value=[],u.value=c.value.length>0,_.value=c.value.length>0}catch{d.value="Unexpected error loading chat messages."}finally{o.value=!1}}}async function le(){if(R.value)return;const r=U.value.trim();if(!r||$.value)return;U.value="",G(()=>Q()),v.value="",$.value=!0;const t=new Date().toISOString(),s={id:`user-${Date.now()}`,role:"user",content:r,timestamp:t};c.value=[...c.value,s];try{const C=await fetch("/api/chat",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,chatId:p.value})}),b=await C.json().catch(()=>({}));if(!C.ok){v.value=b?.error??"Unable to get a recommendation.";return}b&&b.message&&(c.value=[...c.value,b.message]),!p.value&&b&&b.chatId&&(p.value=b.chatId,l.value=b.chatId,m.value=[{id:b.chatId,title:b.chatTitle||"Untitled chat",subtitle:"AI travel recommendations"},...m.value])}catch{v.value="Unexpected error contacting the recommendation engine."}finally{$.value=!1}}function ke(){G(()=>{const r=Z.value;if(r){r.scrollTop=r.scrollHeight;return}const t=ee.value;if(t&&t.length){const s=t[t.length-1];s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"end"})}})}de(c,r=>{Array.isArray(r)&&r.length>0&&(u.value=!0),ke()},{deep:!0});function we(r){if(!r)return"";const t=new Date(r);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function _e(){u.value=!0}function se(){_.value||!u.value&&!Y.value&&!M.value.length||(_.value=!0,M.value.length&&(c.value=M.value,M.value=[]))}function Ce(){h.value=!0}function $e(){h.value=!1}function re(){h.value=!1,f.value=!0}function ae(){f.value=!1}function Me(r){if(ae(),!r||typeof r!="object")return;u.value=!0,K.value=!0;const{chatId:t,chatTitle:s,messages:C}=r,b=Array.isArray(C)?C:[],V=!!(t&&p.value&&t!==p.value);if(b.length)if(_.value||Y.value)!p.value||V?c.value=b:c.value=[...c.value,...b];else{const j=!V&&t&&t===p.value;M.value=j?[...M.value,...b]:b}if(t&&(p.value=t,l.value=t),t){const j=m.value.findIndex(O=>O.id===t);if(j>=0){const O=m.value[j];m.value.splice(j,1,{...O,title:s||O.title||"Untitled chat"})}else m.value=[{id:t,title:s||"Untitled chat",subtitle:"AI travel recommendations"},...m.value]}}function ne(){h.value=!1,k.value=!0}function ie(){k.value=!1}function Ue(r){if(ie(),!r||typeof r!="object")return;u.value=!0,W.value=!0;const{chatId:t,chatTitle:s,messages:C}=r,b=Array.isArray(C)?C:[],V=!!(t&&p.value&&t!==p.value);if(b.length)if(_.value||Y.value)!p.value||V?c.value=b:c.value=[...c.value,...b];else{const j=!V&&t&&t===p.value;M.value=j?[...M.value,...b]:b}if(t&&(p.value=t,l.value=t),t){const j=m.value.findIndex(O=>O.id===t);if(j>=0){const O=m.value[j];m.value.splice(j,1,{...O,title:s||O.title||"Untitled chat"})}else m.value=[{id:t,title:s||"Untitled chat",subtitle:"AI travel recommendations"},...m.value]}}function Ae(){h.value=!1,A.value=!0}function je(){A.value=!1}return(r,t)=>(a(),n("div",Bt,[e("aside",Lt,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs uppercase tracking-[0.4em] text-muted-foreground"},"Trips",-1)),t[8]||(t[8]=e("h2",{class:"mt-2 font-semibold text-foreground"},"Previous recommendations",-1)),e("button",{class:"mt-3 inline-flex items-center rounded-full border border-border/70 bg-background/80 px-3 py-1 text-xs font-medium text-foreground shadow-sm transition hover:bg-muted",onClick:be}," + New chat ")]),e("nav",Nt,[o.value?(a(),n(D,{key:0},[t[9]||(t[9]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1)),t[10]||(t[10]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1)),t[11]||(t[11]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1))],64)):(a(),n(D,{key:1},[(a(!0),n(D,null,E(m.value,s=>(a(),n("button",{key:s.id||s.title,onClick:C=>ye(s),class:B(["w-full rounded-xl px-3 py-3 text-left transition-all",l.value===s.id?"bg-primary text-primary-foreground shadow-sm":"bg-background/80 text-muted-foreground hover:bg-muted/60 hover:text-foreground"])},[e("p",Pt,g(s.title??"Untitled"),1),e("p",{class:B(["mt-1 text-xs",l.value===s.id?"text-primary-foreground/80":"text-muted-foreground/80"])},g(s.subtitle??"No metadata available"),3)],10,Ot))),128)),m.value.length?y("",!0):(a(),n("p",Ht," No recommendations yet. They will appear here once generated. "))],64))]),e("div",Rt,[e("div",Vt,[e("button",{class:"flex w-full items-center justify-between rounded-xl bg-background/80 px-3 py-3 text-sm font-medium text-foreground transition hover:bg-muted",onClick:ve},[e("span",null,g(fe.value),1),(a(),n("svg",{class:B(["size-4 text-muted-foreground transition-transform",x.value?"rotate-180":""]),viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[...t[12]||(t[12]=[e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z","clip-rule":"evenodd"},null,-1)])],2))]),x.value?(a(),n("div",Et,[e("button",{class:"w-full px-4 py-2 text-left text-sm text-muted-foreground hover:bg-muted/70 hover:text-foreground",onClick:xe}," Settings "),e("button",{class:"w-full px-4 py-2 text-left text-sm text-destructive hover:bg-destructive/10",onClick:he,disabled:w.value}," Sign out ",8,Kt)])):y("",!0)])])]),e("main",Wt,[oe.value?(a(),n("header",Yt,[e("div",qt,[e("h1",Jt,g(oe.value),1)])])):y("",!0),d.value?(a(),n("p",Qt,g(d.value),1)):y("",!0),e("section",Gt,[e("div",{ref_key:"messagesScrollRef",ref:Z,class:"flex-1 overflow-y-auto px-6 py-6 lg:px-10"},[e("div",Xt,[o.value?(a(),n(D,{key:0},[t[13]||(t[13]=e("div",{class:"h-28 animate-pulse rounded-3xl bg-muted/50"},null,-1)),t[14]||(t[14]=e("div",{class:"h-24 animate-pulse rounded-3xl bg-muted/50"},null,-1))],64)):(a(),n(D,{key:1},[c.value.length?(a(!0),n(D,{key:0},E(c.value,(s,C)=>(a(),n("div",{key:s.id||s.timestamp||C,ref_for:!0,ref_key:"messageItemsRef",ref:ee,class:B(["rounded-2xl border px-4 py-4 shadow-sm",s.role==="assistant"?"border-border/70 bg-background/90":"border-transparent bg-primary/5 text-primary"])},[e("p",Zt,[I(g(s.role==="assistant"?"Recommendation engine":"You")+" ",1),e("span",eo,g(we(s.timestamp)),1)]),e("div",to,[s.title?(a(),n("p",oo,g(s.title),1)):y("",!0),Array.isArray(s.content)?(a(),n("ul",lo,[(a(!0),n(D,null,E(s.content,(b,V)=>(a(),n("li",{key:V,class:"rounded-xl bg-muted/40 px-3 py-2 text-muted-foreground"},g(b),1))),128))])):s.content?(a(),n(D,{key:2},[s.role==="assistant"?(a(),n("div",{key:0,class:"text-muted-foreground",innerHTML:s.content},null,8,so)):(a(),n("p",ro,g(s.content),1))],64)):y("",!0),!s.content&&!Array.isArray(s.content)?(a(),n("p",ao," No details recorded. ")):y("",!0)])],2))),128)):ce.value?(a(),n("div",no,[t[21]||(t[21]=e("p",{class:"text-sm font-semibold text-foreground"},"Step 1 · Add your travel documents",-1)),t[22]||(t[22]=e("p",{class:"mt-2 text-sm text-muted-foreground"}," Upload tickets or invoices so the assistant understands your trip. You can skip if you don't have files yet. ",-1)),e("div",io,[S(F(z),{variant:"outline",onClick:re},{default:T(()=>[...t[15]||(t[15]=[I("Upload ticket",-1)])]),_:1}),S(F(z),{variant:"outline",onClick:ne},{default:T(()=>[...t[16]||(t[16]=[I("Upload invoice",-1)])]),_:1}),S(F(z),{variant:"ghost",class:"text-muted-foreground hover:text-foreground",onClick:_e},{default:T(()=>[...t[17]||(t[17]=[I(" Skip for now ",-1)])]),_:1})]),e("div",uo,[t[19]||(t[19]=e("p",{class:"font-semibold text-foreground"},"Step 2 · Start chatting",-1)),t[20]||(t[20]=e("p",{class:"mt-1 text-xs text-muted-foreground"}," Press start after you've added documents (or skipped) to begin the conversation. ",-1)),e("div",co,[S(F(z),{disabled:!te.value,onClick:se},{default:T(()=>[...t[18]||(t[18]=[I(" Start chatting ",-1)])]),_:1},8,["disabled"])])])])):(a(),n("div",po," No project activity yet. Share your trip details or attach documents to get recommendations. "))],64))])],512),e("div",fo,[e("div",mo,[S(F(z),{variant:"outline",size:"icon",class:"shrink-0",onClick:Ce,"aria-label":"Attach travel documents"},{default:T(()=>[...t[23]||(t[23]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M10 3.25a.75.75 0 01.75.75v5.25H16a.75.75 0 010 1.5h-5.25V16a.75.75 0 01-1.5 0v-5.25H4a.75.75 0 010-1.5h5.25V4a.75.75 0 01.75-.75z","clip-rule":"evenodd"})],-1)])]),_:1}),Se(e("textarea",{ref_key:"messageInputRef",ref:J,class:B(["flex-1 resize-none bg-transparent text-sm text-foreground placeholder:text-muted-foreground focus:outline-none",R.value?"cursor-not-allowed text-muted-foreground":""]),rows:"1","onUpdate:modelValue":t[0]||(t[0]=s=>U.value=s),placeholder:pe.value,disabled:R.value,onInput:Q,onKeydown:Ie(L(le,["exact","prevent"]),["enter"])},null,42,vo),[[Te,U.value]]),S(F(z),{variant:"outline",disabled:!ue.value||R.value,onClick:le},{default:T(()=>[I(g($.value?"Thinking...":"Ask AI"),1)]),_:1},8,["disabled"])]),R.value?(a(),n("p",go," Add documents or skip, then press “Start chatting” to unlock the chat box. ")):y("",!0),R.value?(a(),n("div",xo,[S(F(z),{size:"sm",disabled:!te.value,onClick:se},{default:T(()=>[...t[24]||(t[24]=[I(" Start chatting ",-1)])]),_:1},8,["disabled"])])):y("",!0),t[25]||(t[25]=e("p",{class:"mt-2 text-center text-xs text-muted-foreground"}," Recommendations are indicative only-always verify travel details (flights, visas, restrictions) before booking. ",-1)),v.value.value?(a(),n("div",bo,g(v.value.value),1)):y("",!0)]),h.value?(a(),q(Re,{key:0,"ticket-uploaded":K.value,"accommodation-uploaded":W.value,onClose:$e,onTicket:re,onAccommodation:ne,onOther:Ae},null,8,["ticket-uploaded","accommodation-uploaded"])):y("",!0),y("",!0),y("",!0),y("",!0),f.value?(a(),q(st,{key:4,"chat-id":p.value,onClose:ae,onUploaded:Me},null,8,["chat-id"])):y("",!0),k.value?(a(),q(yt,{key:5,"chat-id":p.value,onClose:ie,onUploaded:Ue},null,8,["chat-id"])):y("",!0),A.value?(a(),q(zt,{key:6,onClose:je})):y("",!0)])])]))}};export{ko as default};

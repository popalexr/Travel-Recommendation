import{A as d,l,K as e,s as F,q as L,Q as z,v as B,r as u,E as M,N as D,S as V,F as $,C as U,R as f,c as R,w as q,y as pe,n as H,B as g,k as O,L as fe,M as ve,D as xe}from"./main.js";import{_ as I}from"./index.js";const ge={class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm"},be={class:"w-full max-w-sm rounded-2xl border border-border bg-background p-6 shadow-xl"},ye={class:"flex items-start justify-between gap-3"},he={class:"mt-4 space-y-2"},ke={__name:"UploadAttachmentModal",emits:["close","ticket","accommodation","other"],setup(T,{emit:j}){const p=j;return(m,r)=>(l(),d("div",ge,[e("div",be,[e("div",ye,[r[5]||(r[5]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Attach travel documents"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Upload tickets or invoices related to this trip. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:r[0]||(r[0]=c=>p("close")),"aria-label":"Close"},[...r[4]||(r[4]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",he,[F(B(I),{variant:"outline",class:"w-full justify-start",onClick:r[1]||(r[1]=c=>p("ticket"))},{default:L(()=>[...r[6]||(r[6]=[z(" Upload airplane ticket ",-1)])]),_:1}),F(B(I),{variant:"outline",class:"w-full justify-start",onClick:r[2]||(r[2]=c=>p("accommodation"))},{default:L(()=>[...r[7]||(r[7]=[z(" Upload accomodation invoice ",-1)])]),_:1}),F(B(I),{variant:"outline",class:"w-full justify-start",onClick:r[3]||(r[3]=c=>p("other"))},{default:L(()=>[...r[8]||(r[8]=[z(" Upload other document ",-1)])]),_:1})]),r[9]||(r[9]=e("p",{class:"mt-3 text-[11px] text-muted-foreground"}," Uploading is not yet implemented in this prototype. ",-1))])]))}},we={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},_e={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},Ce={class:"flex items-start justify-between gap-3"},$e={class:"mt-5 space-y-4"},Me={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},je={class:"flex min-w-0 flex-1 items-center gap-2"},De={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},Ae={class:"min-w-0"},Ue={class:"truncate font-medium"},Te={class:"text-[11px] text-muted-foreground"},Fe=["onClick"],Le={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},ze={class:"mt-5 flex items-center justify-end gap-3"},Be=["disabled"],Ie={__name:"TicketUploadModal",emits:["close"],setup(T,{emit:j}){const p=j,m=u(!1),r=u([]),c=u(null);function b(){c.value&&c.value.click()}function v(n){if(!n||!n.length)return;const t=Array.from(n).filter(a=>!a||!a.type?!1:a.type.startsWith("image/")||a.type==="application/pdf");t.length&&(r.value=[...r.value,...t])}function y(n){const t=n?.target?.files;v(t)}function h(n){const t=n?.dataTransfer?.files;v(t),m.value=!1}function w(n){n<0||n>=r.value.length||r.value.splice(n,1)}return(n,t)=>(l(),d("div",we,[e("div",_e,[e("div",Ce,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload airplane ticket"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your ticket here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:t[0]||(t[0]=a=>p("close")),"aria-label":"Close"},[...t[5]||(t[5]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",$e,[e("div",{class:D(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[m.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:b,onDragover:t[1]||(t[1]=M(a=>m.value=!0,["prevent"])),onDragleave:t[2]||(t[2]=M(a=>m.value=!1,["prevent"])),onDrop:M(h,["prevent"])},[t[7]||(t[7]=V('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your ticket PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"ticketFileInput",ref:c,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:y},null,544)],34),r.value.length?(l(),d("div",Me,[t[8]||(t[8]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(l(!0),d($,null,U(r.value,(a,x)=>(l(),d("div",{key:x,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",je,[e("div",De,f(x+1),1),e("div",Ae,[e("p",Ue,f(a.name),1),e("p",Te,f((a.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:_=>w(x),"aria-label":"Remove file"}," ? ",8,Fe)]))),128))])):(l(),d("div",Le," No files selected yet. "))]),e("div",ze,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:t[3]||(t[3]=a=>p("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!r.value.length,onClick:t[4]||(t[4]=a=>p("close"))}," Attach ticket ",8,Be)])])]))}},Oe={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},Se={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},Ne={class:"flex items-start justify-between gap-3"},Re={class:"mt-5 space-y-4"},He={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},Ve={class:"flex min-w-0 flex-1 items-center gap-2"},Pe={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},Ke={class:"min-w-0"},Ee={class:"truncate font-medium"},We={class:"text-[11px] text-muted-foreground"},qe=["onClick"],Je={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},Qe={class:"mt-5 flex items-center justify-end gap-3"},Ye=["disabled"],Ge={__name:"AccommodationUploadModal",emits:["close"],setup(T,{emit:j}){const p=j,m=u(!1),r=u([]),c=u(null);function b(){c.value&&c.value.click()}function v(n){if(!n||!n.length)return;const t=Array.from(n).filter(a=>!a||!a.type?!1:a.type.startsWith("image/")||a.type==="application/pdf");t.length&&(r.value=[...r.value,...t])}function y(n){const t=n?.target?.files;v(t)}function h(n){const t=n?.dataTransfer?.files;v(t),m.value=!1}function w(n){n<0||n>=r.value.length||r.value.splice(n,1)}return(n,t)=>(l(),d("div",Oe,[e("div",Se,[e("div",Ne,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload accomodation invoice"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your invoice here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:t[0]||(t[0]=a=>p("close")),"aria-label":"Close"},[...t[5]||(t[5]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",Re,[e("div",{class:D(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[m.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:b,onDragover:t[1]||(t[1]=M(a=>m.value=!0,["prevent"])),onDragleave:t[2]||(t[2]=M(a=>m.value=!1,["prevent"])),onDrop:M(h,["prevent"])},[t[7]||(t[7]=V('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your invoice PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"accommodationFileInput",ref:c,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:y},null,544)],34),r.value.length?(l(),d("div",He,[t[8]||(t[8]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(l(!0),d($,null,U(r.value,(a,x)=>(l(),d("div",{key:x,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",Ve,[e("div",Pe,f(x+1),1),e("div",Ke,[e("p",Ee,f(a.name),1),e("p",We,f((a.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:_=>w(x),"aria-label":"Remove file"}," ? ",8,qe)]))),128))])):(l(),d("div",Je," No files selected yet. "))]),e("div",Qe,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:t[3]||(t[3]=a=>p("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!r.value.length,onClick:t[4]||(t[4]=a=>p("close"))}," Attach invoice ",8,Ye)])])]))}},Xe={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},Ze={class:"w-full max-w-lg rounded-3xl border border-border bg-gradient-to-b from-background/95 to-muted/80 p-6 shadow-2xl"},et={class:"flex items-start justify-between gap-3"},tt={class:"mt-5 space-y-4"},ot={key:0,class:"max-h-40 space-y-2 overflow-y-auto rounded-xl border border-border/70 bg-background/70 px-3 py-2"},rt={class:"flex min-w-0 flex-1 items-center gap-2"},st={class:"flex size-6 items-center justify-center rounded-full bg-background/80 text-[10px] text-muted-foreground"},nt={class:"min-w-0"},lt={class:"truncate font-medium"},at={class:"text-[11px] text-muted-foreground"},it=["onClick"],dt={key:1,class:"rounded-xl bg-muted/40 px-3 py-2 text-[11px] text-muted-foreground"},ut={class:"mt-5 flex items-center justify-end gap-3"},ct=["disabled"],mt={__name:"OtherUploadModal",emits:["close"],setup(T,{emit:j}){const p=j,m=u(!1),r=u([]),c=u(null);function b(){c.value&&c.value.click()}function v(n){if(!n||!n.length)return;const t=Array.from(n).filter(a=>!a||!a.type?!1:a.type.startsWith("image/")||a.type==="application/pdf");t.length&&(r.value=[...r.value,...t])}function y(n){const t=n?.target?.files;v(t)}function h(n){const t=n?.dataTransfer?.files;v(t),m.value=!1}function w(n){n<0||n>=r.value.length||r.value.splice(n,1)}return(n,t)=>(l(),d("div",Xe,[e("div",Ze,[e("div",et,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-base font-semibold text-foreground"},"Upload other document"),e("p",{class:"mt-1 text-xs text-muted-foreground"}," Drag and drop your document here, or browse files from your device. ")],-1)),e("button",{class:"rounded-full p-1 text-muted-foreground hover:bg-muted",onClick:t[0]||(t[0]=a=>p("close")),"aria-label":"Close"},[...t[5]||(t[5]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),e("div",tt,[e("div",{class:D(["relative flex cursor-pointer flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center transition",[m.value?"border-primary bg-primary/5":"border-border/70 bg-muted/40 hover:border-primary/60 hover:bg-muted/60"]]),onClick:b,onDragover:t[1]||(t[1]=M(a=>m.value=!0,["prevent"])),onDragleave:t[2]||(t[2]=M(a=>m.value=!1,["prevent"])),onDrop:M(h,["prevent"])},[t[7]||(t[7]=V('<div class="mb-3 flex items-center justify-center rounded-full bg-primary/10 p-3 text-primary"><svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path d="M7 10.5L12 5.5L17 10.5M12 6V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 18.5C4.067 18.5 2.5 16.933 2.5 15C2.5 13.067 4.067 11.5 6 11.5H7M18 11.5C19.933 11.5 21.5 13.067 21.5 15C21.5 16.933 19.933 18.5 18 18.5H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-sm font-medium text-foreground">Drop your document PDF or image here</p><p class="mt-1 text-xs text-muted-foreground"> Supports PDF and image files. Max 10MB per file. </p><button type="button" class="mt-4 rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90"> Browse files </button>',4)),e("input",{ref_key:"otherFileInput",ref:c,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:y},null,544)],34),r.value.length?(l(),d("div",ot,[t[8]||(t[8]=e("p",{class:"mb-1 text-[11px] font-medium uppercase tracking-[0.2em] text-muted-foreground"}," Selected files ",-1)),(l(!0),d($,null,U(r.value,(a,x)=>(l(),d("div",{key:x,class:"flex items-center justify-between rounded-lg bg-muted/60 px-3 py-2 text-xs text-foreground"},[e("div",rt,[e("div",st,f(x+1),1),e("div",nt,[e("p",lt,f(a.name),1),e("p",at,f((a.size/1024/1024).toFixed(2))+" MB ",1)])]),e("button",{type:"button",class:"ml-3 rounded-full p-1 text-[10px] text-muted-foreground hover:bg-background/70",onClick:_=>w(x),"aria-label":"Remove file"}," ? ",8,it)]))),128))])):(l(),d("div",dt," No files selected yet. "))]),e("div",ut,[e("button",{class:"rounded-full px-3 py-1.5 text-xs font-medium text-muted-foreground hover:bg-muted",onClick:t[3]||(t[3]=a=>p("close"))}," Cancel "),e("button",{class:"rounded-full bg-primary px-4 py-1.5 text-xs font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",disabled:!r.value.length,onClick:t[4]||(t[4]=a=>p("close"))}," Attach document ",8,ct)])])]))}},pt={class:"flex h-screen bg-background text-foreground"},ft={class:"hidden h-full w-72 flex-col border-r border-border/60 bg-muted/30 px-4 py-6 md:flex"},vt={class:"mt-6 flex-1 space-y-2 overflow-y-auto pr-2"},xt=["onClick"],gt={class:"text-sm font-medium leading-tight"},bt={key:0,class:"text-xs text-muted-foreground/80"},yt={class:"border-t border-border/50 pt-4"},ht={class:"relative"},kt={key:0,class:"absolute bottom-14 left-0 w-full rounded-xl border border-border/50 bg-background/95 shadow-lg backdrop-blur"},wt=["disabled"],_t={class:"flex flex-1 flex-col overflow-hidden bg-background"},Ct={key:0,class:"border-b border-border/60 bg-background/80 px-6 py-5 backdrop-blur lg:px-10"},$t={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between"},Mt={class:"text-xl font-semibold tracking-tight sm:text-2xl"},jt={key:1,class:"px-6 pt-3 text-xs text-destructive lg:px-10"},Dt={class:"relative flex flex-1 flex-col overflow-hidden"},At={class:"mx-auto w-full max-w-4xl space-y-6"},Ut={class:"text-xs uppercase tracking-[0.3em] text-muted-foreground/80"},Tt={class:"ml-2 text-muted-foreground/60"},Ft={class:"mt-3 space-y-3 text-sm leading-relaxed"},Lt={key:0,class:"text-sm font-semibold text-foreground"},zt={key:1,class:"space-y-3"},Bt=["innerHTML"],It={key:1,class:"text-muted-foreground"},Ot={key:3,class:"text-muted-foreground/70"},St={key:1,class:"rounded-2xl border border-dashed border-border/70 px-4 py-10 text-center text-sm text-muted-foreground"},Nt={class:"border-t border-border/60 bg-background/95 px-6 py-5 lg:px-10"},Rt={class:"mx-auto flex w-full max-w-4xl items-center gap-3 rounded-2xl border border-border/70 bg-background/80 px-4 py-3 shadow-sm"},Ht=["onKeydown"],Vt={key:0,class:"mx-auto mt-3 w-full max-w-4xl rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-sm text-destructive"},Et={__name:"Dashboard",props:{user:{type:Object,default:()=>({})}},setup(T){const j=T,p=u(!1),m=u(""),r=u(!1),c=u(null),b=u([]),v=u([]),y=u(null),h=u(""),w=u(!1),n=u(!1),t=u(!1);u(!1),u([]),u(null);const a=u(!1);u(!1),u([]),u(null);const x=u(!1);u(!1),u([]),u(null);const _=u(""),A=u(!0),J=R(()=>h.value.trim().length>0&&!w.value),S=u(null),P=u(null),K=u([]),E=R(()=>{const i=c.value??y.value;if(!i)return"";const o=b.value.find(C=>C.id===i);if(!o||!o.title)return"";const s=String(o.title).trim();return s.length?s:""}),Q=R(()=>{const{firstName:i,lastName:o,email:s}=j.user??{};return i||o?[i,o].filter(Boolean).join(" ").trim()||"Traveler":s??"Traveler"});q(b,i=>{if(!i||i.length===0){c.value=null;return}i.find(s=>s.id===c.value)||(c.value=i[0]?.id??null)},{immediate:!0});async function Y(){A.value=!0,_.value="";try{const i=await fetch("/api/dashboard",{credentials:"same-origin"});if(!i.ok){_.value="Unable to fetch dashboard data.";return}const o=await i.json().catch(()=>({})),s=Array.isArray(o.previousRecommendations)?o.previousRecommendations:[];b.value=s,v.value=Array.isArray(o.chatMessages)?o.chatMessages:[],s.length>0&&!c.value&&(c.value=s[0].id,y.value=s[0].id)}catch{_.value="Unexpected error loading dashboard."}finally{A.value=!1}}pe(()=>{Y(),H(()=>{S.value&&N()})});function G(){r.value=!r.value}function X(){r.value=!1}function Z(){X(),window.location.href="/settings"}async function ee(){if(!p.value){m.value="",p.value=!0;try{const i=await fetch("/logout",{method:"POST",credentials:"same-origin"}),o=await i.json().catch(()=>({}));if(!i.ok){m.value=o?.message??"Unable to log out.";return}window.location.href="/"}catch{m.value="Unexpected error. Please try again."}finally{p.value=!1}}}function N(){const i=S.value;if(!i)return;const o=36,s=128;i.style.height="auto";const C=Math.min(Math.max(i.scrollHeight,o),s);i.style.height=`${C}px`}async function te(i){if(!(!i||!i.id)){c.value=i.id,y.value=i.id,_.value="",A.value=!0;try{const o=await fetch(`/api/chat/${i.id}/messages`,{credentials:"same-origin"});if(!o.ok){_.value="Unable to load chat messages.";return}const s=await o.json().catch(()=>({}));v.value=Array.isArray(s.messages)?s.messages:[]}catch{_.value="Unexpected error loading chat messages."}finally{A.value=!1}}}async function W(){const i=h.value.trim();if(!i||w.value)return;h.value="",H(()=>N()),m.value="",w.value=!0;const o=new Date().toISOString(),s={id:`user-${Date.now()}`,role:"user",content:i,timestamp:o};v.value=[...v.value,s];try{const C=await fetch("/api/chat",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,chatId:y.value})}),k=await C.json().catch(()=>({}));if(!C.ok){m.value=k?.error??"Unable to get a recommendation.";return}k&&k.message&&(v.value=[...v.value,k.message]),!y.value&&k&&k.chatId&&(y.value=k.chatId,c.value=k.chatId,b.value=[{id:k.chatId,title:k.chatTitle||"Untitled chat",subtitle:"AI travel recommendations"},...b.value])}catch{m.value="Unexpected error contacting the recommendation engine."}finally{w.value=!1}}function oe(){H(()=>{const i=P.value;if(i){i.scrollTop=i.scrollHeight;return}const o=K.value;if(o&&o.length){const s=o[o.length-1];s&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"end"})}})}q(v,()=>{oe()},{deep:!0});function re(i){if(!i)return"";const o=new Date(i);return Number.isNaN(o.getTime())?"":o.toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function se(){n.value=!0}function ne(){n.value=!1}function le(){n.value=!1,t.value=!0}function ae(){t.value=!1}function ie(){n.value=!1,a.value=!0}function de(){a.value=!1}function ue(){n.value=!1,x.value=!0}function ce(){x.value=!1}return(i,o)=>(l(),d("div",pt,[e("aside",ft,[e("div",null,[o[8]||(o[8]=e("p",{class:"text-xs uppercase tracking-[0.4em] text-muted-foreground"},"Trips",-1)),o[9]||(o[9]=e("h2",{class:"mt-2 font-semibold text-foreground"},"Previous recommendations",-1)),e("button",{class:"mt-3 inline-flex items-center rounded-full border border-border/70 bg-background/80 px-3 py-1 text-xs font-medium text-foreground shadow-sm transition hover:bg-muted",onClick:o[0]||(o[0]=()=>{c.value=null,y.value=null,v.value=[],h.value=""})}," + New chat ")]),e("nav",vt,[A.value?(l(),d($,{key:0},[o[10]||(o[10]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1)),o[11]||(o[11]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1)),o[12]||(o[12]=e("div",{class:"h-14 animate-pulse rounded-xl bg-muted/60"},null,-1))],64)):(l(),d($,{key:1},[(l(!0),d($,null,U(b.value,s=>(l(),d("button",{key:s.id||s.title,onClick:C=>te(s),class:D(["w-full rounded-xl px-3 py-3 text-left transition-all",c.value===s.id?"bg-primary text-primary-foreground shadow-sm":"bg-background/80 text-muted-foreground hover:bg-muted/60 hover:text-foreground"])},[e("p",gt,f(s.title??"Untitled"),1),e("p",{class:D(["mt-1 text-xs",c.value===s.id?"text-primary-foreground/80":"text-muted-foreground/80"])},f(s.subtitle??"No metadata available"),3)],10,xt))),128)),b.value.length?g("",!0):(l(),d("p",bt," No recommendations yet. They will appear here once generated. "))],64))]),e("div",yt,[e("div",ht,[e("button",{class:"flex w-full items-center justify-between rounded-xl bg-background/80 px-3 py-3 text-sm font-medium text-foreground transition hover:bg-muted",onClick:G},[e("span",null,f(Q.value),1),(l(),d("svg",{class:D(["size-4 text-muted-foreground transition-transform",r.value?"rotate-180":""]),viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[...o[13]||(o[13]=[e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z","clip-rule":"evenodd"},null,-1)])],2))]),r.value?(l(),d("div",kt,[e("button",{class:"w-full px-4 py-2 text-left text-sm text-muted-foreground hover:bg-muted/70 hover:text-foreground",onClick:Z}," Settings "),e("button",{class:"w-full px-4 py-2 text-left text-sm text-destructive hover:bg-destructive/10",onClick:ee,disabled:p.value}," Sign out ",8,wt)])):g("",!0)])])]),e("main",_t,[E.value?(l(),d("header",Ct,[e("div",$t,[e("h1",Mt,f(E.value),1)])])):g("",!0),_.value?(l(),d("p",jt,f(_.value),1)):g("",!0),e("section",Dt,[e("div",{ref_key:"messagesScrollRef",ref:P,class:"flex-1 overflow-y-auto px-6 py-6 lg:px-10"},[e("div",At,[A.value?(l(),d($,{key:0},[o[14]||(o[14]=e("div",{class:"h-28 animate-pulse rounded-3xl bg-muted/50"},null,-1)),o[15]||(o[15]=e("div",{class:"h-24 animate-pulse rounded-3xl bg-muted/50"},null,-1))],64)):(l(),d($,{key:1},[v.value.length?(l(!0),d($,{key:0},U(v.value,(s,C)=>(l(),d("div",{key:s.id||s.timestamp||C,ref_for:!0,ref_key:"messageItemsRef",ref:K,class:D(["rounded-2xl border px-4 py-4 shadow-sm",s.role==="assistant"?"border-border/70 bg-background/90":"border-transparent bg-primary/5 text-primary"])},[e("p",Ut,[z(f(s.role==="assistant"?"Recommendation engine":"You")+" ",1),e("span",Tt,f(re(s.timestamp)),1)]),e("div",Ft,[s.title?(l(),d("p",Lt,f(s.title),1)):g("",!0),Array.isArray(s.content)?(l(),d("ul",zt,[(l(!0),d($,null,U(s.content,(k,me)=>(l(),d("li",{key:me,class:"rounded-xl bg-muted/40 px-3 py-2 text-muted-foreground"},f(k),1))),128))])):s.content?(l(),d($,{key:2},[s.role==="assistant"?(l(),d("div",{key:0,class:"text-muted-foreground",innerHTML:s.content},null,8,Bt)):(l(),d("p",It,f(s.content),1))],64)):g("",!0),!s.content&&!Array.isArray(s.content)?(l(),d("p",Ot," No details recorded. ")):g("",!0)])],2))),128)):(l(),d("div",St," No project activity yet. Once the recommendation engine generates travel suggestions, they will be summarized here. "))],64))])],512),e("div",Nt,[e("div",Rt,[F(B(I),{variant:"outline",size:"icon",class:"shrink-0",onClick:se,"aria-label":"Attach travel documents"},{default:L(()=>[...o[16]||(o[16]=[e("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"size-4"},[e("path",{"fill-rule":"evenodd",d:"M10 3.25a.75.75 0 01.75.75v5.25H16a.75.75 0 010 1.5h-5.25V16a.75.75 0 01-1.5 0v-5.25H4a.75.75 0 010-1.5h5.25V4a.75.75 0 01.75-.75z","clip-rule":"evenodd"})],-1)])]),_:1}),fe(e("textarea",{ref_key:"messageInputRef",ref:S,class:"flex-1 resize-none bg-transparent text-sm text-foreground placeholder:text-muted-foreground focus:outline-none",rows:"1","onUpdate:modelValue":o[1]||(o[1]=s=>h.value=s),placeholder:"Describe your trip and what you need help with...",onInput:N,onKeydown:xe(M(W,["exact","prevent"]),["enter"])},null,40,Ht),[[ve,h.value]]),F(B(I),{variant:"outline",disabled:!J.value,onClick:W},{default:L(()=>[z(f(w.value?"Thinking...":"Ask AI"),1)]),_:1},8,["disabled"])]),o[17]||(o[17]=e("p",{class:"mt-2 text-center text-xs text-muted-foreground"}," Recommendations are indicative onlyâ€”always verify travel details (flights, visas, restrictions) before booking. ",-1)),m.value.value?(l(),d("div",Vt,f(m.value.value),1)):g("",!0)]),n.value?(l(),O(ke,{key:0,onClose:ne,onTicket:le,onAccommodation:ie,onOther:ue})):g("",!0),g("",!0),g("",!0),g("",!0),t.value?(l(),O(Ie,{key:4,onClose:ae})):g("",!0),a.value?(l(),O(Ge,{key:5,onClose:de})):g("",!0),x.value?(l(),O(mt,{key:6,onClose:ce})):g("",!0)])])]))}};export{Et as default};
